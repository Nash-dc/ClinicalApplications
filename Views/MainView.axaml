<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:ClinicalApplications.ViewModels"
    x:Class="ClinicalApplications.Views.MainView"
    x:DataType="vm:MainViewViewModel">

  <Grid Margin="16" RowDefinitions="Auto,*">

    <Expander Grid.Row="0"
              IsExpanded="True"
              Header="Actions"
              Padding="12"
              Margin="0,0,0,12">
      <Grid ColumnDefinitions="Auto,*,Auto"
            RowDefinitions="Auto,Auto">

        <Button Grid.Row="0" Grid.Column="0"
                Content="Upload Patient CSV"
                Click="OnUploadCsvClicked"
                HorizontalAlignment="Left"/>

        <TextBox Grid.Row="0" Grid.Column="1"
                 Text="{Binding Prompt, Mode=TwoWay}"
                 Watermark="Type your prompt here..."
                 MinWidth="420"/>

        <Button Grid.Row="0" Grid.Column="2"
                Content="Send"
                Command="{Binding SendRequestCommand}"
                HorizontalAlignment="Right"/>

      </Grid>
    </Expander>

    <ScrollViewer Grid.Row="1"
                  VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="12">

        <Border CornerRadius="8" Padding="8" BorderThickness="1" Opacity="0.98">
          <DataGrid ItemsSource="{Binding PatientDisplay}"
                    IsReadOnly="True"
                    AutoGenerateColumns="False"
                    HeadersVisibility="Column"
                    CanUserReorderColumns="False"
                    CanUserResizeColumns="True"
                    CanUserSortColumns="False"
                    MinHeight="120" MaxHeight="260">
            <DataGrid.Columns>

              <DataGridTemplateColumn Header="Field" Width="2*">
                <DataGridTemplateColumn.CellTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Label}">
                      <ToolTip.Tip>
                        <TextBlock Text="{Binding Tooltip}" TextWrapping="Wrap" MaxWidth="360"/>
                      </ToolTip.Tip>
                    </TextBlock>
                  </DataTemplate>
                </DataGridTemplateColumn.CellTemplate>
              </DataGridTemplateColumn>

              <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="*"/>
            </DataGrid.Columns>
          </DataGrid>
        </Border>

        <Border CornerRadius="8" Padding="8" BorderThickness="1">
          <StackPanel>
            <TextBlock Text="AI Advice:" FontWeight="SemiBold" Margin="0,0,0,6"/>
            <TextBox Text="{Binding Reply}"
                     AcceptsReturn="True"
                     IsReadOnly="True"
                     TextWrapping="Wrap"
                     MinHeight="180"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
          </StackPanel>
        </Border>

        <Border CornerRadius="8" Padding="8" BorderThickness="1">
          <TextBlock Text="{Binding StatusMessage}"/>
        </Border>

      </StackPanel>
    </ScrollViewer>

  </Grid>
</UserControl>
